// imports
const logger = require('./logger');
const outbound = require('./outbound');
const request = require('request');
const jssoup = require('jssoup').default;
const difflib = require('difflib');
const range = require('lodash.range');

const relevantRegularHeaders = {received: '', 'content-type': '', 'bounces-to': '', 'date': '', 'delivered-to': '', 'message-id': '', 'return-path': '',
                      'errors-to': '', 'from': '', 'importance': '', 'list-help': '', 'list-id': '', 'list-owner': '',
                      'list-post': '', 'reply-to': '', 'received-spf': '', 'sender': '', 'subject': '', 'list-unsubscribe': '',
                      'content-type': ''};

const relevantRegularImageAttributes = { 'alt':'', 'align':'', 'border':'', 'border-style':'', 'class':'', 'contextmenu':'', 'dir':'', 'height':'',
                      'hidden':'', 'hspace':'', 'id':'', 'ismap':'', 'lang':'', 'longdesc':'', 'src':'', 'style':'', 'tabindex':'', 'title':'',
                      'usemap':'', 'vspace':'', 'valign':'', 'width':'' };

const relevantImageStyleAttributes = { 'style':'', 'color':'', 'font-family':'', 'font-size':'', 'text-align':'', 'height':'', 'width':'', 'display':'',
                      'opacity':'','max-width':'', 'max-height':'', 'margin':'', 'background-color':''};

// Functions created in order of their calling by Haraka
exports.register = () => {
  logger.loginfo("Starting Tracking Prevention Plugin");
};

exports.hook_data = (next, connection) => {
  connection.transaction.parse_body = true;
  next();
};

exports.hook_queue = (next, connection) => {
  var plugin = this;
  var transaction = connection.transaction;
  var emailTo = transaction.rcpt_to;
  var body = transaction.body; //transaction.message_stream.pipe(writeStream);
  var headers = body.header.headers_decoded;
  var bodytext = body.bodytext;

  plugin.mlcomm(mailExtractor(body, headers));

  var to = emailTo;
  var from = headers.from[0];

  var contents = [
      "From: " + from,
      "To: " + to,
      `MIME-Version: ${headers['mime-version'][0]}`,
      `Content-type: ${ body.ct }; charset=${ body.body_encoding }`,
      `Subject: ${ headers.subject[0] }`,
      "",
      bodytext,
      ""].join("\n");

  var outnext = function (code, msg) {
      switch (code) {
          case DENY:  logger.logerror("Sending mail failed: " + msg);
                      break;
          case OK:    logger.loginfo("mail sent");
                      next();
                      break;
          default:    logger.logerror("Unrecognized return code from sending email: " + msg);
                      next();
      }
  };

  //outbound.send_email(from, to, contents, outnext);
  next();
};

exports.shutdown = () => {
  logger.loginfo("Shutting down Tracking Prevention Plugin.");
};


// Worker Functions
async function mlcomm (body) {
  // var testbody = [{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.5692,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.6738,"minLinkSimilarity":0.29442,"src":"http://www.stern.de/blob/4541962/12efb66149ef9afcdd6358728aecdf2c/newsletter-twitter-data.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":31,"imgCount":48,"relImagePosition":0.64583,"imagesToBorder":17,"linkLength":93,"numbers":0.24731,"upperLetters":0,"caseChanges":0,"numalphaChange":0.07527,"count_b":3.22581,"count_f":4.30108,"count_i":1.07527,"count_m":0,"count_w":5.37634,"count_b_meandev":0.14106,"count_f_meandev":2.23701,"count_i_meandev":-0.55742,"count_m_meandev":-0.99094,"count_w_meandev":2.04576,"relSrcLength":0.06639,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":27,"relFilenameLength":0.09392,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.60417,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.56763,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.68817,"minLinkSimilarity":0.26531,"src":"http://www.stern.de/blob/4541956/5d8f1ab2775aed4e80f2b9a74698fc6b/newsletter-google-data.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":32,"imgCount":48,"relImagePosition":0.66667,"imagesToBorder":16,"linkLength":92,"numbers":0.27174,"upperLetters":0,"caseChanges":0,"numalphaChange":0.13043,"count_b":5.43478,"count_f":3.26087,"count_i":0,"count_m":0,"count_w":4.34783,"count_b_meandev":2.35004,"count_f_meandev":1.1968,"count_i_meandev":-1.63269,"count_m_meandev":-0.99094,"count_w_meandev":1.01724,"relSrcLength":0,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":26,"relFilenameLength":0,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.60417,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.58708,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.67391,"minLinkSimilarity":0.36735,"src":"http://www.stern.de/blob/4541948/1af15e194a8807d62750a907f99dd920/newsletter-arrows-data.gif","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":33,"imgCount":48,"relImagePosition":0.6875,"imagesToBorder":15,"linkLength":92,"numbers":0.32609,"upperLetters":0,"caseChanges":0,"numalphaChange":0.09783,"count_b":2.17391,"count_f":3.26087,"count_i":1.08696,"count_m":0,"count_w":5.43478,"count_b_meandev":-0.91083,"count_f_meandev":1.1968,"count_i_meandev":-0.54574,"count_m_meandev":-0.99094,"count_w_meandev":2.1042,"relSrcLength":0,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":26,"relFilenameLength":0,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.14583,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":0},{"mailCounter":47,"align":0,"alt":"Sarah Lombardi","avgLinkSimilarity":0.34826,"border":3,"class":"['colimg2']","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.39796,"minLinkSimilarity":0.27411,"src":"http://image.stern.de/7288158/16x9-290-161/ab471dd8807143798d503475766d41cb/lA/sarah-lombardi-berlin.jpg","style_background.color":0,"style_color":0,"style_display":1,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"Sarah Lombardi","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":34,"imgCount":48,"relImagePosition":0.70833,"imagesToBorder":14,"linkLength":104,"numbers":0.38462,"upperLetters":0.00962,"caseChanges":0.00962,"numalphaChange":0.06731,"count_b":3.84615,"count_f":0,"count_i":2.88462,"count_m":1.92308,"count_w":0,"count_b_meandev":0.76141,"count_f_meandev":-2.06407,"count_i_meandev":1.25192,"count_m_meandev":0.93213,"count_w_meandev":-3.33058,"relSrcLength":0.79669,"folderDepth":6,"relFolderDepth":1.3994,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":2,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":25,"relFilenameLength":-0.09392,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.14583,"domain":"//image.stern.de/","domainLength":17,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.125,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":14,"titleLength":14,"classLength":11,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":1,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":0},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.56582,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.69892,"minLinkSimilarity":0.26667,"src":"http://www.stern.de/blob/4541954/42c2ebd497bab0969c909a468d55103a/newsletter-facebook-data.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":35,"imgCount":48,"relImagePosition":0.72917,"imagesToBorder":13,"linkLength":94,"numbers":0.29787,"upperLetters":0,"caseChanges":0,"numalphaChange":0.09574,"count_b":6.38298,"count_f":1.06383,"count_i":0,"count_m":0,"count_w":4.25532,"count_b_meandev":3.29823,"count_f_meandev":-1.00024,"count_i_meandev":-1.63269,"count_m_meandev":-0.99094,"count_w_meandev":0.92474,"relSrcLength":0.13278,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":28,"relFilenameLength":0.18785,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.60417,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.52082,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.6738,"minLinkSimilarity":0.29442,"src":"http://www.stern.de/blob/4541962/12efb66149ef9afcdd6358728aecdf2c/newsletter-twitter-data.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":36,"imgCount":48,"relImagePosition":0.75,"imagesToBorder":12,"linkLength":93,"numbers":0.24731,"upperLetters":0,"caseChanges":0,"numalphaChange":0.07527,"count_b":3.22581,"count_f":4.30108,"count_i":1.07527,"count_m":0,"count_w":5.37634,"count_b_meandev":0.14106,"count_f_meandev":2.23701,"count_i_meandev":-0.55742,"count_m_meandev":-0.99094,"count_w_meandev":2.04576,"relSrcLength":0.06639,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":27,"relFilenameLength":0.09392,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.60417,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.47192,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.68817,"minLinkSimilarity":0.25767,"src":"http://www.stern.de/blob/4541956/5d8f1ab2775aed4e80f2b9a74698fc6b/newsletter-google-data.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":37,"imgCount":48,"relImagePosition":0.77083,"imagesToBorder":11,"linkLength":92,"numbers":0.27174,"upperLetters":0,"caseChanges":0,"numalphaChange":0.13043,"count_b":5.43478,"count_f":3.26087,"count_i":0,"count_m":0,"count_w":4.34783,"count_b_meandev":2.35004,"count_f_meandev":1.1968,"count_i_meandev":-1.63269,"count_m_meandev":-0.99094,"count_w_meandev":1.01724,"relSrcLength":0,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":26,"relFilenameLength":0,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.60417,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.44081,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.67391,"minLinkSimilarity":0.2875,"src":"http://www.stern.de/blob/4541948/1af15e194a8807d62750a907f99dd920/newsletter-arrows-data.gif","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":38,"imgCount":48,"relImagePosition":0.79167,"imagesToBorder":10,"linkLength":92,"numbers":0.32609,"upperLetters":0,"caseChanges":0,"numalphaChange":0.09783,"count_b":2.17391,"count_f":3.26087,"count_i":1.08696,"count_m":0,"count_w":5.43478,"count_b_meandev":-0.91083,"count_f_meandev":1.1968,"count_i_meandev":-0.54574,"count_m_meandev":-0.99094,"count_w_meandev":2.1042,"relSrcLength":0,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":2,"countIDsFilename":0,"minFolderLength":4,"maxFolderLength":32,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":26,"relFilenameLength":0,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":3,"sharedFileformat":0.14583,"domain":"//www.stern.de/","domainLength":15,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.5625,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":0},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.48993,"border":3,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.74627,"minLinkSimilarity":0.24242,"src":"https://newsletter.stern.de/imgproxy/img/715830055/B_Lovescout_01b2.jpg","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"600","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":39,"imgCount":48,"relImagePosition":0.8125,"imagesToBorder":9,"linkLength":71,"numbers":0.16901,"upperLetters":0.02817,"caseChanges":0.01408,"numalphaChange":0.01408,"count_b":2.8169,"count_f":0,"count_i":2.8169,"count_m":2.8169,"count_w":1.40845,"count_b_meandev":-0.26784,"count_f_meandev":-2.06407,"count_i_meandev":1.18421,"count_m_meandev":1.82596,"count_w_meandev":-1.92213,"relSrcLength":-1.39421,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":20,"relFilenameLength":-0.56354,"longestNr":2,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":1,"sharedFileformat":0.14583,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":1,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":0},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.62004,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":11,"hspace":"NA","id":"","maxLinkSimilarity":0.85496,"minLinkSimilarity":0.27097,"src":"http://newsletter.stern.de/imgproxy/img/679805010/nach-oben.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":30,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":40,"imgCount":48,"relImagePosition":0.83333,"imagesToBorder":8,"linkLength":63,"numbers":0.14286,"upperLetters":0,"caseChanges":0,"numalphaChange":0,"count_b":1.5873,"count_f":0,"count_i":3.1746,"count_m":3.1746,"count_w":1.5873,"count_b_meandev":-1.49744,"count_f_meandev":-2.06407,"count_i_meandev":1.54191,"count_m_meandev":2.18366,"count_w_meandev":-1.74328,"relSrcLength":-1.92534,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":13,"relFilenameLength":-1.22099,"longestNr":0,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":2,"nrOfWords":2,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":330,"stdWidthHeightRatio":0.94908,"ratioSmallerImg":0.91667,"outsiderArea":1,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":1,"areaClassarea10pxto100px":0,"areaClassareaMissing":0,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"icon","avgLinkSimilarity":0.68567,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":60,"hspace":"NA","id":"","maxLinkSimilarity":0.88889,"minLinkSimilarity":0.275,"src":"http://newsletter.stern.de/imgproxy/img/679805011/facebook-60x60.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":60,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":41,"imgCount":48,"relImagePosition":0.85417,"imagesToBorder":7,"linkLength":68,"numbers":0.19118,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01471,"count_b":1.47059,"count_f":1.47059,"count_i":2.94118,"count_m":2.94118,"count_w":1.47059,"count_b_meandev":-1.61416,"count_f_meandev":-0.59348,"count_i_meandev":1.30848,"count_m_meandev":1.95023,"count_w_meandev":-1.85999,"relSrcLength":-1.59339,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":18,"relFilenameLength":-0.75138,"longestNr":2,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":2,"nrOfWords":1,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":3600,"stdWidthHeightRatio":0,"ratioSmallerImg":0.97917,"outsiderArea":1,"vhspace":"NA","altLength":4,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":1,"areaClassarea10pxto100px":0,"areaClassareaMissing":0,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"icon","avgLinkSimilarity":0.75562,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":60,"hspace":"NA","id":"","maxLinkSimilarity":0.88889,"minLinkSimilarity":0.26415,"src":"http://newsletter.stern.de/imgproxy/img/679805012/twitter-60x60.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":60,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":42,"imgCount":48,"relImagePosition":0.875,"imagesToBorder":6,"linkLength":67,"numbers":0.19403,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01493,"count_b":0,"count_f":0,"count_i":4.47761,"count_m":2.98507,"count_w":2.98507,"count_b_meandev":-3.08475,"count_f_meandev":-2.06407,"count_i_meandev":2.84492,"count_m_meandev":1.99413,"count_w_meandev":-0.34551,"relSrcLength":-1.65978,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":17,"relFilenameLength":-0.8453,"longestNr":2,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":2,"nrOfWords":1,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":3600,"stdWidthHeightRatio":0,"ratioSmallerImg":0.97917,"outsiderArea":1,"vhspace":"NA","altLength":4,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":1,"areaClassarea10pxto100px":0,"areaClassareaMissing":0,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"icon","avgLinkSimilarity":0.81237,"border":0,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":60,"hspace":"NA","id":"","maxLinkSimilarity":0.88722,"minLinkSimilarity":0.68613,"src":"http://newsletter.stern.de/imgproxy/img/679805013/g-plus-60x60.png","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":60,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":43,"imgCount":48,"relImagePosition":0.89583,"imagesToBorder":5,"linkLength":66,"numbers":0.19697,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01515,"count_b":0,"count_f":0,"count_i":3.0303,"count_m":3.0303,"count_w":1.51515,"count_b_meandev":-3.08475,"count_f_meandev":-2.06407,"count_i_meandev":1.39761,"count_m_meandev":2.03936,"count_w_meandev":-1.81543,"relSrcLength":-1.72617,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":16,"relFilenameLength":-0.93923,"longestNr":2,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":1,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":3600,"stdWidthHeightRatio":0,"ratioSmallerImg":0.97917,"outsiderArea":1,"vhspace":"NA","altLength":4,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":1,"areaClassarea10pxto100px":0,"areaClassareaMissing":0,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.81117,"border":0,"class":"['colimg4']","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.94366,"minLinkSimilarity":0.425,"src":"http://newsletter.stern.de/imgproxy/img/679805014/apps-icon-135x135.png","style_background.color":0,"style_color":0,"style_display":1,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"auto","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":135,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":44,"imgCount":48,"relImagePosition":0.91667,"imagesToBorder":4,"linkLength":71,"numbers":0.21127,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01408,"count_b":0,"count_f":0,"count_i":4.22535,"count_m":2.8169,"count_w":1.40845,"count_b_meandev":-3.08475,"count_f_meandev":-2.06407,"count_i_meandev":2.59266,"count_m_meandev":1.82596,"count_w_meandev":-1.92213,"relSrcLength":-1.39421,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":21,"relFilenameLength":-0.46961,"longestNr":3,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":2,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":135,"stdWidthHeightRatio":0,"ratioSmallerImg":0.875,"outsiderArea":1,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":11,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.80743,"border":0,"class":"['colimg4']","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.94366,"minLinkSimilarity":0.425,"src":"http://newsletter.stern.de/imgproxy/img/679805015/heft-icon-135x135.png","style_background.color":0,"style_color":0,"style_display":1,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"auto","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":135,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":45,"imgCount":48,"relImagePosition":0.9375,"imagesToBorder":3,"linkLength":71,"numbers":0.21127,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01408,"count_b":0,"count_f":1.40845,"count_i":4.22535,"count_m":2.8169,"count_w":1.40845,"count_b_meandev":-3.08475,"count_f_meandev":-0.65562,"count_i_meandev":2.59266,"count_m_meandev":1.82596,"count_w_meandev":-1.92213,"relSrcLength":-1.39421,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":21,"relFilenameLength":-0.46961,"longestNr":3,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":2,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":135,"stdWidthHeightRatio":0,"ratioSmallerImg":0.875,"outsiderArea":1,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":11,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.80541,"border":0,"class":"['colimg4']","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.94366,"minLinkSimilarity":0.425,"src":"http://newsletter.stern.de/imgproxy/img/679805016/emag-icon-135x135.png","style_background.color":0,"style_color":0,"style_display":1,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"auto","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":135,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":46,"imgCount":48,"relImagePosition":0.95833,"imagesToBorder":2,"linkLength":71,"numbers":0.21127,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01408,"count_b":0,"count_f":0,"count_i":4.22535,"count_m":4.22535,"count_w":1.40845,"count_b_meandev":-3.08475,"count_f_meandev":-2.06407,"count_i_meandev":2.59266,"count_m_meandev":3.23441,"count_w_meandev":-1.92213,"relSrcLength":-1.39421,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":21,"relFilenameLength":-0.46961,"longestNr":3,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":2,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":135,"stdWidthHeightRatio":0,"ratioSmallerImg":0.875,"outsiderArea":1,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":11,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.78452,"border":0,"class":"['colimg4']","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.91892,"minLinkSimilarity":0.40964,"src":"http://newsletter.stern.de/imgproxy/img/679805017/newsletter-icon-135x135.png","style_background.color":0,"style_color":0,"style_display":1,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"auto","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":135,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":47,"imgCount":48,"relImagePosition":0.97917,"imagesToBorder":1,"linkLength":77,"numbers":0.19481,"upperLetters":0,"caseChanges":0,"numalphaChange":0.01299,"count_b":0,"count_f":0,"count_i":3.8961,"count_m":2.5974,"count_w":2.5974,"count_b_meandev":-3.08475,"count_f_meandev":-2.06407,"count_i_meandev":2.26341,"count_m_meandev":1.60646,"count_w_meandev":-0.73318,"relSrcLength":-0.99587,"folderDepth":5,"relFolderDepth":0,"spotTrackSrc":0,"spotIDSrc":0,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":0,"countIDsPath":1,"countIDsFilename":0,"minFolderLength":3,"maxFolderLength":9,"matchSrcUnsubscribe":0,"matchSrcSpf":0,"matchSrcReturn":0,"imageFilenameLength":27,"relFilenameLength":0.09392,"longestNr":3,"nrStringsCount":0,"equalSignCount":0,"punctCharCount":3,"nrOfWords":2,"sharedFileformat":0.60417,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":135,"stdWidthHeightRatio":0,"ratioSmallerImg":0.875,"outsiderArea":1,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":11,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":0,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":1,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":1},{"mailCounter":47,"align":0,"alt":"","avgLinkSimilarity":0.43667,"border":3,"class":"","countIdenticalImg":0,"exist_custom_keys":0,"height":1,"hspace":"NA","id":"","maxLinkSimilarity":0.45,"minLinkSimilarity":0.42169,"src":"http://newsletter.stern.de/tr/p.gif?uid=21139491760&mid=2102001314&msd=1484830809598&st=0","style_background.color":0,"style_color":0,"style_display":0,"style_font.family":0,"style_font.size":0,"style_height":"NA","style_margin":"","style_max.height":"NA","style_max.width":"NA","style_text.align":"","style_width":"NA","title":"","usemap":"","vspace":"NA","width":1,"content.type":"text/html; charset=UTF-8","date":"2017-01-19 13:00:40","delivered.to":"michael.mayer1001@gmail.com","errors.to":"","from":"stern Lifestyle <lifestyle@newsletter.stern.de>","list.help":"<mailto:complaint@intl.teradatadmc.com>","list.id":"<2100066605.newsletter.stern.de>","list.owner":"","list.post":"","list.unsubscribe":"<http://newsletter.stern.de/public/list_unsubscribe.jsp?action=listUnsubscribe&gid=2100066605&uid=21139491760&mid=2102001314&siglistunsub=BKPOMADBHEIEDOJF&errorPage=/public/list_unsubscribe.jsp>, <mailto:listunsubscribe-2100066605-2102001314-21139491760@newsletter.stern.de>","message.id":"<pcs6ku.iy4dy0oyw85qz9sal@newsletter.stern.de>","received":"from app05.muc.ec-messenger.com (app05.muc.domeus.com [172.16.8.35])\n\tby mta025.muc.domeus.com (READY) with ESMTP id 114E012002E04\n\tfor <michael.mayer1001@gmail.com>; Thu, 19 Jan 2017 14:00:40 +0100 (CET)","received.spf":"pass (google.com: domain of g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de designates 195.140.185.136 as permitted sender) client-ip=195.140.185.136;","reply.to":"\"stern.de - Lifestyle Newsletter\" <newsletter@stern.de>","return.path":"<g-21139491760-21169-2102001314-1484830840067@bounce.newsletter.stern.de>","sender":"","subject":"Aktuelle News aus dem Lifestyle-Ressort","from_mail":"lifestyle@newsletter.stern.de","from_name":"stern Lifestyle","date_stamp":"20170119","mailID":"20170119-Aktuelle News aus dem Lifestyle-Ressort-1","imgPos":48,"imgCount":48,"relImagePosition":1,"imagesToBorder":0,"linkLength":89,"numbers":0.39326,"upperLetters":0,"caseChanges":0,"numalphaChange":0,"count_b":0,"count_f":1.1236,"count_i":3.37079,"count_m":2.24719,"count_w":1.1236,"count_b_meandev":-3.08475,"count_f_meandev":-0.94047,"count_i_meandev":1.73809,"count_m_meandev":1.25625,"count_w_meandev":-2.20699,"relSrcLength":-0.19917,"folderDepth":3,"relFolderDepth":-2.79881,"spotTrackSrc":0,"spotIDSrc":1,"spotListSrc":0,"spotUserSrc":0,"spotClickSrc":0,"spotTagSrc":0,"spotViewSrc":0,"spotOpenSrc":0,"spotAt":0,"spotQuestionmark":1,"countIDsPath":0,"countIDsFilename":3,"minFolderLength":2,"maxFolderLength":2,"matchSrcUnsubscribe":1,"matchSrcSpf":1,"matchSrcReturn":1,"imageFilenameLength":59,"relFilenameLength":3.09945,"longestNr":13,"nrStringsCount":3,"equalSignCount":4,"punctCharCount":5,"nrOfWords":0,"sharedFileformat":0.14583,"domain":"//newsletter.stern.de/","domainLength":22,"senderDomain":"stern","matchSendernameImage":1,"imageSenderSameDomain":1,"sharedDomain":0.20833,"area":1,"stdWidthHeightRatio":0,"ratioSmallerImg":0.79167,"outsiderArea":0,"vhspace":"NA","altLength":0,"titleLength":0,"classLength":0,"idLength":0,"unsubscribeLength":274,"unsubscribeAdresses":2,"contentTypeLength":24,"areaClassarea00px":0,"areaClassarea01px":1,"areaClassarea01to10px":0,"areaClassarea100pxPlus":0,"areaClassarea10pxto100px":0,"areaClassareaMissing":0,"fileFormatjpg":0,"fileFormatnone":0,"fileFormatother":0,"fileFormatphp":0,"fileFormatpng":0}];

  // // consider mails without images
  // // if no image just forward if just one image add a dummy image because ML can just cope with 2+ images
  // request({
  //     url: 'http://localhost:8080/checkImages',
  //     method: "POST",
  //     json: true,
  //     headers: {
  //         "content-type": "application/json",
  //     },
  //     body: testbody
  //   },
  //   (err,res,body) => {
  //     if (err) { logger.logerror(err) };
  //     logger.loginfo('RESULT IS: ',body, Array.isArray(body));
  //   }
  // );

}

// Extracting e-mail useful for classification
function extractHeaders (headers) {
  let extractedHeaders = { mailCounter: 1 };
  for (var key in headers) {
    if (key.toLowerCase() in relevantRegularHeaders) {
      extractedHeaders[key.toLowerCase()] = headers[key].length === 1 ? headers[key][0] : headers[key];
    }
  }
  return extractedHeaders;
};

function getStdImgTags (imgTags) {
  let imgTagsStd = {
    mailCounter: 1,
    avgLinkSimilarity: 0,
    minLinkSimilarity: 0,
    maxLinkSimilarity: 0,
    countIdenticalImg: 0
  };
  for (var key in relevantRegularImageAttributes) {
    if (key in imgTags) {
      imgTagsStd[key] = imgTags[key];
    }
  }
  return imgTagsStd;
};

function checkCustomKeys (imgTags, imgTagsStd, imgTagStdLength) {
  Object.keys(imgTags).length > imgTagStdLength ? imgTagsStd['exist_custom_keys'] = 1 : imgTagsStd['exist_custom_keys'] = 0;
  for (var key in imgTagsStd) {
    if (imgTagsStd[key] === null) {
      imgTagsStd[key] = "CODEERR";
    }
  }
};

function destructStyling (imgTags, imgTagsStd) {
  let styleAttrObj = {};
  imgTags.style.split('; ').forEach(styleAttr => {
    let tempArr = styleAttr.split(': ');
    if (tempArr.length === 2 && tempArr[0] in relevantImageStyleAttributes) {
      styleAttrObj['style_' + tempArr[0]] = tempArr[1];
    }
  });
  imgTagsStd = Object.assign(imgTagsStd, styleAttrObj);
  delete imgTagsStd.style;
};

function extractImages (body) {
  let bodySoup = new jssoup(body.bodytext);
  let imgTagStdLength;

  return bodySoup.findAll('img').map(Image => {
    var imgTagsStd = getStdImgTags(Image.attrs);
    imgTagStdLength = Object.keys(imgTagsStd).length;
    if (imgTagStdLength > 0) {
      checkCustomKeys(Image.attrs, imgTagsStd, imgTagStdLength);
      if ('style' in Image.attrs) {
        destructStyling(Image.attrs, imgTagsStd)
      }
    }
    return imgTagsStd;
  });
};

function calcLinkSims (mailImagesArr) {
  let i = 0;
  let tempImgSrcs = mailImagesArr.map(ImageStd => {
    if ('src' in ImageStd) {
      return ImageStd.src;
    }
  });

  mailImagesArr.forEach(img => {
    if (tempImgSrcs.length > 1 && 'src' in img) {
      const indices = range(Math.max(0,i-4), Math.min(i+4,tempImgSrcs.length - 1) + 1);
      var tmp = tempImgSrcs.map((tmpImgSrc, index) => {
        if (index != i) {
          return tmpImgSrc;
        }
      });
      tmp = tmp.filter(ele => ele != undefined);
      var simratios = tmp.map(otherImg => {
        return new difflib.SequenceMatcher(null, img['src'], otherImg['src']).ratio();
      });
      img['avgLinkSimilarity'] = simratios.reduce((a,b) => (a+b)) / simratios.length;
      img['minLinkSimilarity'] = Math.min(simratios);
      img['maxLinkSimilarity'] = Math.max(simratios);
      img['countIdenticalImg'] = simratios.reduce((val, acc) => val === 1 ? acc++ : acc, 0); // nochmal anschauen
      i++;
    }
  });
};

// Using Regex for Link replacement
// var imgSources = [].join('|');
// var re = new RegExp("\\"+"url1|url2", "ig");
// var res = str.replace(re, "replacement URL");

// Preparing mail data for classification from ML-algorithm
function mailExtractor (body, headers) {
  const mailImages = extractImages(body);
  calcLinkSims(mailImages);
  //logger.loginfo(mailImages);

  return Object.assign(extractHeaders(headers), mailImages);
};





